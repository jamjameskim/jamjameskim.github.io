<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê³ ì–‘ì´ ë­í‚¹</title>

  <!-- SEO & SNS -->
  <meta name="description" content="ê·€ì—¬ìš´ ê³ ì–‘ì´ ì¹´ë“œë¡œ ê¸°ì–µë ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”! ëˆ„êµ¬ë‚˜ ì¦ê¸¸ ìˆ˜ ìˆëŠ” ê°„ë‹¨í•œ ì¹´ë“œ ë’¤ì§‘ê¸° ê²Œì„.">
  <meta property="og:title" content="ê³ ì–‘ì´ ì°¾ê¸° ê¸°ì–µë ¥ ê²Œì„">
  <meta property="og:description" content="ê·€ì—¬ìš´ ê³ ì–‘ì´ë“¤ê³¼ì˜ ê¸°ì–µë ¥ ëŒ€ê²°! ë‹¹ì‹ ë„ ë„ì „í•´ë³´ì„¸ìš”.">
  <meta property="og:image" content="https://jamjameskim.github.io/images/metaImage.png">
  <meta property="og:url" content="https://jamjameskim.github.io">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ê³ ì–‘ì´ ì°¾ê¸° ê¸°ì–µë ¥ ê²Œì„">
  <meta name="twitter:description" content="ê·€ì—¬ìš´ ê³ ì–‘ì´ë“¤ê³¼ì˜ ê¸°ì–µë ¥ ëŒ€ê²°! ë‹¹ì‹ ë„ ë„ì „í•´ë³´ì„¸ìš”.">
  <meta name="twitter:image" content="https://jamjameskim.github.io/images/metaImage.png">
  <meta name="twitter:url" content="https://jamjameskim.github.io">

  <!-- Pretendard Font -->
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet"/>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5NZTKSZPPG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-5NZTKSZPPG');
  </script>

  <!-- ìŠ¤íƒ€ì¼ -->
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      height: 100vh;
      background: #fff8ea;
      font-family: 'Pretendard', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #app {
      text-align: center;
      width: 100%;
      max-width: 400px;
      padding: 20px;
    }

    h1 {
      font-size: 26px;
      color: #FF9640;
      margin-bottom: 10px;
    }

    #ranking-list {
      list-style: none;
      padding: 0;
      margin: 0 auto 20px;
    }

    #ranking-list li {
      text-align: center;
      padding: 8px;
      border-bottom: 1px solid #ddd;
      font-size: 16px;
      color: #333;
    }

    #loading {
      color: #999;
      margin-bottom: 20px;
    }

    #registerBtn {
      display: none;
      margin: 20px auto;
      padding: 14px 24px;
      background: #FF9640;
      box-shadow: 0 4px 0 #d1792e;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    #popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 1px solid #ccc;
      padding: 20px;
      box-shadow: 2px 2px 10px #aaa;
      border-radius: 10px;
      width: 260px;
      text-align: center;
      z-index: 1000;
    }

    #popup input {
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }

    #popup button {
      margin-top: 10px;
      width: 100%;
      padding: 12px;
      background-color: #FF9640;
      box-shadow: 0 4px 0 #d1792e;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #popup button:disabled {
      background-color: #ccc;
      box-shadow: none;
      color: #666;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>ğŸ† ê³ ì–‘ì´ ì°¾ê¸° ë­í‚¹</h1>
    <p>ë­í‚¹ì€ ìƒìœ„ 10ê°œë§Œ í‘œì‹œë©ë‹ˆë‹¤:)</p>
    <p id="loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    <ul id="ranking-list"></ul>
    <button id="registerBtn">ë­í‚¹ ë“±ë¡í•˜ê¸°</button>
  </div>

  <div id="popup">
    <p>ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:</p>
    <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„">
    <button id="saveBtn">ì €ì¥</button>
  </div>

  <script>
    const score = Number(localStorage.getItem("cat-game-score") || 0);
    const registered = localStorage.getItem("scoreRegistered");
    const registerBtn = document.getElementById("registerBtn");
    const popup = document.getElementById("popup");
    const loading = document.getElementById("loading");
    const list = document.getElementById("ranking-list");
    const saveButton = document.getElementById("saveBtn");

    if (score > 0 && score < 1000 && !registered) {
      registerBtn.style.display = "block";
    }

    registerBtn.addEventListener("click", () => {
      popup.style.display = "block";
    });

    saveButton.addEventListener("click", async () => {
      const nickname = document.getElementById("nicknameInput").value.trim();

      if (!nickname) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      saveButton.disabled = true;
      saveButton.textContent = "ì €ì¥ì¤‘...";

      try {
        await fetch("https://script.google.com/macros/s/AKfycbxNSzz6xzFxNpm3o4OKRIN5dJ9Ps2Td2BTZDgdZxGi-ExfYIpWdXkMY1E8ZPgKmtf0c/exec", {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify({ nickname, score })
        });

        localStorage.setItem("scoreRegistered", "true");
        alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        popup.style.display = "none";
        registerBtn.style.display = "none";
        fetchRanking();
      } catch (err) {
        alert("ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      } finally {
        saveButton.disabled = false;
        saveButton.textContent = "ì €ì¥";
      }
    });

    function fetchRanking() {
      loading.style.display = "block";

      fetch("https://script.google.com/macros/s/AKfycbxNSzz6xzFxNpm3o4OKRIN5dJ9Ps2Td2BTZDgdZxGi-ExfYIpWdXkMY1E8ZPgKmtf0c/exec")
        .then(res => res.json())
        .then(data => {
          list.innerHTML = '';
          data.slice(0, 10).forEach((entry, i) => {
            const li = document.createElement("li");
            li.textContent = `${i + 1}ìœ„ - ${entry.nickname}: ${entry.score}ì `;
            list.appendChild(li);
          });
          loading.style.display = "none";
        })
        .catch(() => {
          loading.textContent = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨ ğŸ˜¿";
        });
    }

    fetchRanking();
  </script>
</body>
</html>